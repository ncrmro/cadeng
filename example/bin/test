#!/usr/bin/env bash
set -euo pipefail

# Run tests and verify SCAD generation
cd "$(dirname "$0")/.."

echo "==> Running pytest..."
uv run pytest -v

echo "==> Verifying SCAD generation..."
uv run python -m src --render

echo "==> Checking registry..."
uv run python -m src --list | uv run python -c "
import json, sys
parts = json.load(sys.stdin)
print(f'Registry: {len(parts)} parts')
for p in parts:
    print(f'  {p[\"name\"]} ({p[\"type\"]}, stl={p[\"stl\"]})')
"

echo "==> All checks passed."
